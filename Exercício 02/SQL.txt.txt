CREATE TABLE public.produtos
(
    valor_unit real NOT NULL,
    quantidade integer NOT NULL,
    id_nf integer NOT NULL,
    id_item integer NOT NULL,
    cod_prod integer NOT NULL,
    desconto integer,
    PRIMARY KEY (cod_prod)
);

ALTER TABLE public.produtos
    OWNER to postgres;


INSERT INTO public.produtos(
	valor_unit, quantidade, id_nf, id_item, cod_prod)
	VALUES (15, 3, 5, 1, 3);
	
INSERT INTO public.produtos(
	valor_unit, quantidade, id_nf, id_item, cod_prod)
	VALUES (30, 6, 5, 2, 5);
	
INSERT INTO public.produtos(
	valor_unit, quantidade, id_nf, id_item, cod_prod, desconto)
	VALUES (23, 22, 6, 1, 1, 15);

INSERT INTO public.produtos(
	valor_unit, quantidade, id_nf, id_item, cod_prod, desconto)
	VALUES (15, 25, 6, 2, 3, 20);

INSERT INTO public.produtos(
	valor_unit, quantidade, id_nf, id_item, cod_prod, desconto)
	VALUES (25, 10, 7, 1, 1, 3);
	
INSERT INTO public.produtos(
	valor_unit, quantidade, id_nf, id_item, cod_prod, desconto)
	VALUES (13.5, 10, 7, 2, 2, 4);
	
INSERT INTO public.produtos(
	valor_unit, quantidade, id_nf, id_item, cod_prod, desconto)
	VALUES (15, 10, 7, 3, 3, 4);
	
INSERT INTO public.produtos(
	valor_unit, quantidade, id_nf, id_item, cod_prod, desconto)
	VALUES (30, 10, 7, 4, 5, 1);


QuestÃ£o 01 - 
select id_nf, id_item, cod_prod, valor_unit from produtos
where desconto is null;


select id_nf, id_item, cod_prod, valor_unit, desconto from produtos
where desconto is null;


select id_nf, id_item, cod_prod, valor_unit, coalesce (valor_unit - (valor_unit *(desconto/100))) as valor_vendido from produtos
where desconto is not null;

select valor_unit, desconto, valor_unit - (valor_unit *(desconto/100)) as valor_vendido from produtos where desconto is not null;

UPDATE public.produtos SET desconto=0 WHERE desconto is null;


select id_nf, id_item, cod_prod, valor_unit, quantidade, 
quantidade * valor_unit as valor_total,
valor_unit - (valor_unit *(desconto/100)) as valor_vendido
from produtos 
where id_item is not null; 

select id_nf, sum(quantidade * valor_unit ) as valor_total from produtos group by id_nf order by valor_total desc;

select id_nf, valor_unit - (valor_unit *(desconto/100)) as valor_vendido from produtos order by valor_vendido desc;

select id_nf, sum(valor_unit - (valor_unit *(desconto/100))) as valor_vendido from produtos group by id_nf order by valor_vendido desc;

select cod_prod, sum(quantidade) as qtd_total from produtos group by cod_prod order by qtd_total desc;

SELECT valor_unit, quantidade, id_nf, id_item, cod_prod, desconto
	FROM public.produtos;
	
select id_nf, id_item, cod_prod, valor_unit, desconto from produtos
where desconto is null;

select id_nf, id_item, cod_prod, valor_unit from produtos where desconto is not null;

select valor_unit, desconto, valor_unit - (valor_unit *(desconto/100)) as valor_vendido from produtos where desconto is not null;

select id_nf, id_item, cod_prod, valor_unit, quantidade, 
quantidade * valor_unit as valor_total,
valor_unit - (valor_unit *(desconto/100)) as valor_vendido
from produtos 
where id_item is not null; 

select id_nf, sum(quantidade * valor_unit ) as valor_total from produtos group by id_nf order by valor_total desc;

select id_nf, sum(valor_unit - (valor_unit *(desconto/100))) as valor_vendido from produtos group by id_nf order by valor_vendido desc;

select cod_prod, quantidade from produtos order by quantidade desc;

select cod_prod, sum(quantidade) as qtd_total from produtos group by cod_prod order by qtd_total desc;

select id_nf, cod_prod, quantidade from produtos where quantidade > 10;
select * from produtos;

select id_nf, sum(quantidade * valor_unit) as valor_total 
from produtos 
group by id_nf 
order by valor_total desc 
limit 4;

select cod_prod, avg(quantidade * (valor_unit - (valor_unit *(desconto/100)))) as media from produtos group by cod_prod;

select cod_prod,
avg(desconto) as media_desconto, 
min(desconto) as menor_desconto,
max(desconto) as maior_desconto
from produtos
group by cod_prod


select id_nf, sum(quantidade) as qtd_itens from produtos where quantidade > 3 group by id_nf order by qtd_itens desc;



UPDATE public.produtos
	SET quantidade=13
	WHERE id_nf = 3 and id_item = 1 and cod_prod = 5;
	
select * from produtos where id_nf = 3 and id_item = 1 and cod_prod = 5;